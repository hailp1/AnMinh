generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- CORE SYSTEM ---

model User {
  id           String   @id @default(uuid())
  username     String?  @unique // Optional for now as employeeCode is main identifier
  employeeCode String?  @unique
  password     String
  name         String?
  email        String?  @unique
  phone        String?
  role         String   @default("user") // ADMIN, TDV, QL, KT, PHARMACY, DELIVERY
  isActive     Boolean  @default(true)
  routeCode    String?
  channel      String?
  
  managerId    String?
  manager      User?    @relation("ManagerToStaff", fields: [managerId], references: [id])
  staff        User[]   @relation("ManagerToStaff")
  
  regionId     String?
  region       Region?  @relation(fields: [regionId], references: [id])

  // Relations
  customerAssignments CustomerAssignment[]
  routes              Route[]
  orders              Order[]
  visitPlans          VisitPlan[]
  kpiTargets          KpiTarget[]
  kpiResults          KpiResult[]
  incentives          Incentive[]
  sentMessages        Message[] @relation("SentMessages")
  receivedMessages    Message[] @relation("ReceivedMessages")
  approvalRequests    ApprovalRequest[] @relation("Requester")
  approvalActions     ApprovalAction[]
  organizedActivities TradeActivity[]
  pharmacyRepPharmacies PharmacyRepPharmacy[]
  managedWarehouses     Warehouse[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Region {
  id          String   @id @default(uuid())
  name        String                    // Miền Nam
  code        String   @unique          // MIEN_NAM
  description String?
  
  // Management
  managerId   String?                   // Regional Sales Manager
  managerName String?                   // Cache for display
  
  // Metrics
  targetRevenue    Float?               // Mục tiêu doanh số
  currentRevenue   Float?   @default(0) // Doanh số hiện tại
  customerCount    Int?     @default(0)
  territoryCount   Int?     @default(0)
  
  // Relations
  users         User[]
  territories   Territory[]
  businessUnits BusinessUnit[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BusinessUnit {
  id          String   @id @default(uuid())
  code        String   @unique          // BU_HCM_WEST
  name        String                    // Đơn vị KD HCM Tây
  description String?
  
  // Management
  managerId   String?                   // Area Sales Manager
  managerName String?
  
  // Hierarchy
  regionId    String
  region      Region   @relation(fields: [regionId], references: [id])
  territories Territory[]
  
  // Metrics
  targetRevenue  Float?
  currentRevenue Float?   @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Territory {
  id          String   @id @default(uuid())
  name        String                    // Quận 1
  code        String   @unique          // TER_HCM_Q1
  description String?
  
  // Hierarchy
  regionId    String
  region      Region   @relation(fields: [regionId], references: [id])
  businessUnitId String?
  businessUnit   BusinessUnit? @relation(fields: [businessUnitId], references: [id])
  
  // Management & Assignment
  assignedRepId  String?               // TDV phụ trách
  assignedRepName String?              // Cache for display
  
  // Geography Coverage
  districts      String[]              // Danh sách quận/huyện thuộc territory
  wards          String[]              // Danh sách phường/xã
  
  // Visit Planning
  visitDays      String[]              // ["MON", "WED", "FRI"]
  
  // Metrics
  potentialValue   Float?              // Tiềm năng thị trường
  targetRevenue    Float?              // Mục tiêu doanh số
  currentRevenue   Float?  @default(0) // Doanh số hiện tại
  customerCount    Int?    @default(0) // Số khách hàng
  activeCustomers  Int?    @default(0) // Số KH hoạt động
  coverageRate     Float?  @default(0) // Tỷ lệ phủ (%)
  
  // Relations
  pharmacies          Pharmacy[]
  visitPlans          VisitPlan[]
  customerAssignments CustomerAssignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([regionId])
  @@index([assignedRepId])
}

// --- CUSTOMER MANAGEMENT ---

model CustomerSegment {
  id        String   @id @default(uuid())
  name      String
  code      String   @unique
  description String?
  minOrderAmount Float?
  minOrderCount Int?
  benefits    String[]
  
  pharmacies Pharmacy[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Pharmacy {
  id        String   @id @default(uuid())
  
  // === IDENTIFICATION ===
  name      String                    // Tên chính thức
  code      String?  @unique          // Mã KH: KH-HCM-001
  tradeName String?                   // Tên thương mại/biển hiệu
  taxCode   String?                   // Mã số thuế
  
  // === CLASSIFICATION (CRM Standard) ===
  type      String?  @default("PHARMACY") // PHARMACY, CLINIC, HOSPITAL, DISTRIBUTOR, OTHER
  channel   String?  @default("OTC")      // ETC, OTC, HOSPITAL_TENDER, ONLINE
  segment   String?  @default("C")        // A, B, C, D (theo tiềm năng)
  tier      String?  @default("STANDARD") // VIP, GOLD, SILVER, BRONZE, STANDARD
  classification String?              // Phân loại chi tiết
  organizationType String?            // Cá nhân, Công ty, Chuỗi
  isChain   Boolean? @default(false)  // Thuộc chuỗi
  chainId   String?                   // Mã chuỗi nếu có
  
  // === CONTACT INFO ===
  phone     String?
  phone2    String?                   // Số điện thoại phụ
  orderPhone String?                  // SĐT đặt hàng
  email     String?
  website   String?
  
  // === ADDRESS (Full Structure) ===
  address   String?                   // Địa chỉ đầy đủ
  addressLine2 String?                // Tòa nhà, tầng
  ward      String?                   // Phường/Xã
  district  String?                   // Quận/Huyện
  province  String?                   // Tỉnh/Thành phố
  postalCode String?                  // Mã bưu điện
  country   String?  @default("VN")
  latitude  Float?
  longitude Float?
  
  // === BUSINESS LICENSE ===
  licenseNumber    String?            // Số giấy phép KD
  licenseExpiry    DateTime?          // Ngày hết hạn GP
  pharmacistName   String?            // Dược sĩ phụ trách
  pharmacistLicense String?           // Chứng chỉ hành nghề DS
  staffName        String?            // Nhân viên bán thuốc
  ownerName        String?            // Chủ sở hữu
  
  // === FINANCIAL (CRM Standard) ===
  creditLimit      Float?   @default(0)    // Hạn mức công nợ
  paymentTermDays  Int?     @default(30)   // Số ngày thanh toán
  currentDebt      Float?   @default(0)    // Công nợ hiện tại
  taxExempt        Boolean? @default(false)
  bankAccount      String?
  bankName         String?
  bankBranch       String?
  
  // === SALES ASSIGNMENT ===
  territoryId      String?
  territory        Territory? @relation(fields: [territoryId], references: [id])
  primaryRepId     String?            // TDV phụ trách chính
  secondaryRepId   String?            // TDV backup
  
  // === LIFECYCLE STATUS (CRM Standard) ===
  status           String?  @default("ACTIVE") // PROSPECT, ACTIVE, INACTIVE, SUSPENDED, CHURNED
  source           String?            // Nguồn KH: REFERRAL, COLD_CALL, EVENT, ONLINE
  acquiredDate     DateTime?          // Ngày trở thành KH
  lastOrderDate    DateTime?
  lastVisitDate    DateTime?
  lifetimeValue    Float?   @default(0) // Tổng giá trị lịch sử
  
  // === VISIT PLANNING ===
  visitFrequency   Int?     @default(1)   // Số lần ghé/tuần
  orderFrequency   String?               // Tần độ đặt hàng
  preferredDay     String?               // Thứ ưu tiên ghé
  preferredTime    String?               // Khung giờ
  
  // === ADDITIONAL INFO ===
  description      String?  @db.Text
  notes            String?  @db.Text
  tags             String[]              // Tags: "vip", "khó tính"
  images           String[]
  isVerified       Boolean  @default(false)
  isActive         Boolean  @default(true)
  
  // === LEGACY FIELDS ===
  rawRegion        String?
  linkCode         String?
  
  // === SEGMENT RELATION ===
  customerSegmentId String?
  customerSegment   CustomerSegment? @relation(fields: [customerSegmentId], references: [id])

  // === RELATIONS ===
  customerAssignments CustomerAssignment[]
  routes              Route[]
  orders              Order[]
  visitPlans          VisitPlan[]
  loyaltyPoints       LoyaltyPoint[]
  loyaltyTransactions LoyaltyTransaction[]
  loyaltyRedemptions  LoyaltyRedemption[]
  promotionApplications PromotionApplication[]
  pharmacyPrices      PharmacyProductPrice[]
  pharmacyRepPharmacies PharmacyRepPharmacy[]

  // === AUDIT ===
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  
  @@index([province, district])
  @@index([territoryId])
  @@index([status])
  @@index([segment])
  @@index([createdAt])
  @@index([isActive, segment])  // For active customer filtering
  @@index([territoryId, isActive])  // For territory queries
  @@index([status, segment])  // For status and segment filtering
}

model CustomerAssignment {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  pharmacyId String
  pharmacy  Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  territoryId String?
  territory   Territory? @relation(fields: [territoryId], references: [id])
  
  assignedBy String?
  notes      String?
  isActive   Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Support table for many-to-many relation compatibility
model PharmacyRepPharmacy {
  id         String   @id @default(uuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  pharmacyId String
  pharmacy   Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([userId, pharmacyId])
}

// --- PRODUCT MANAGEMENT ---

model ProductGroup {
  id          String    @id @default(uuid())
  name        String
  code        String?
  description String?
  order       Int       @default(0)
  isActive    Boolean   @default(true)
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id          String       @id @default(uuid())
  
  // Basic Information
  name        String
  code        String?      @unique
  genericName String?      // Tên hoạt chất
  description String?      @db.Text
  unit        String?      // Chai, Hộp, Viên, Gói
  packingSpec String?      // Chai 40 viên, Hộp 3 vỉ x 10 viên
  
  // Classification
  groupId     String?
  group       ProductGroup? @relation(fields: [groupId], references: [id])
  categoryId  String?
  category    Category?     @relation(fields: [categoryId], references: [id])
  
  // Manufacturer
  manufacturer    String?   // NADYPHAR, SANOFI...
  countryOfOrigin String?   // Việt Nam, Pháp...
  
  // Pricing
  price           Float?    // Giá bán chính
  costPrice       Float?    // Giá nhập
  wholesalePrice  Float?    // Giá bán sỉ
  retailPrice     Float?    // Giá bán lẻ
  
  // Identification
  barcode         String?   @unique
  sku             String?   @unique
  
  conversionRate  Int?      @default(1) // Quy đổi: 1 Thùng = X Lẻ
  registrationNo  String?   // Số đăng ký VD-xxxxx-xx
  
  // Stock Management
  minStock        Int?      @default(10)
  maxStock        Int?      @default(1000)
  reorderPoint    Int?      @default(20)
  
  // Attributes
  isPrescription  Boolean   @default(false) // Thuốc kê đơn (ETC)
  isControlled    Boolean   @default(false)
  isRefrigerated  Boolean   @default(false)
  storageCondition String?
  
  // Pharma Details
  concentration     String?   // Hàm lượng
  usage             String?   // Đường dùng (Uống, Tiêm...)
  indications       String?   @db.Text // Chỉ định
  contraindications String?   @db.Text // Chống chỉ định
  dosage            String?   @db.Text // Liều dùng
  sideEffects       String?   @db.Text // Tác dụng phụ
  shelfLife         String?   // Hạn dùng
  vat               Float?    // VAT
  
  // Promotion
  promotionNote     String?   // Ghi chú khuyến mãi (VD: Mua 10 tặng 1)
  
  // Status
  isActive        Boolean   @default(true)
  isCombo         Boolean   @default(false) // NEW: Is this a virtual bundle/combo?
  order           Int       @default(0)
  images          String[]
  imageUrl        String?
  
  // Metadata
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  createdBy   String?
  updatedBy   String?

  // Relations
  orderItems      OrderItem[]
  promotionItems  PromotionItem[]
  inventoryItems  InventoryItem[]
  productPrices   ProductPrice[]
  batches         ProductBatch[]
  pharmacyPrices  PharmacyProductPrice[]
  inventoryTransactions InventoryTransaction[]
  
  // Bundle Relations
  bundleItems     ProductBundleItem[] @relation("BundleParent")
  partOfBundles   ProductBundleItem[] @relation("BundleChild")

  @@index([name])
  @@index([manufacturer])
  @@index([groupId])
}

model ProductBundleItem {
  id          String   @id @default(uuid())
  parentId    String   // The Combo Product ID
  parent      Product  @relation("BundleParent", fields: [parentId], references: [id])
  
  childId     String   // The Component Product ID
  child       Product  @relation("BundleChild", fields: [childId], references: [id])
  
  quantity    Int      @default(1) // How many of Child are in Parent Combo
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([parentId, childId])
}

model ProductPrice {
  id          String   @id @default(uuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  price       Float
  currency    String   @default("VND")
  effectiveDate DateTime
  endDate     DateTime?
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PharmacyProductPrice {
  id          String   @id @default(uuid())
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  price       Float
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Category {
  id              String    @id @default(uuid())
  code            String    @unique
  name            String
  description     String?
  parentId        String?
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  parent          Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children        Category[] @relation("CategoryHierarchy")
  products        Product[]
}

model ProductBatch {
  id              String    @id @default(uuid())
  productId       String
  batchNumber     String
  expiryDate      DateTime
  manufacturingDate DateTime?
  
  initialQuantity Int
  currentQuantity Int
  costPrice       Float?
  
  warehouseId     String?
  location        String?
  status          String    @default("ACTIVE")
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  product         Product   @relation(fields: [productId], references: [id])
  warehouse       Warehouse? @relation(fields: [warehouseId], references: [id])
  
  @@unique([productId, batchNumber])
}

model Warehouse {
  id              String    @id @default(uuid())
  code            String    @unique
  name            String
  type            String?
  
  address         String?
  province        String?
  district        String?
  
  managerId       String?
  managerName     String?
  phone           String?
  
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  manager         User?     @relation(fields: [managerId], references: [id])
  inventoryItems  InventoryItem[]
  batches         ProductBatch[]
  inventoryTransactions InventoryTransaction[]
}

model InventoryItem {
  id              String    @id @default(uuid())
  productId       String
  warehouseId     String
  
  beginningQty    Int       @default(0)
  receivedQty     Int       @default(0)
  issuedQty       Int       @default(0)
  currentQty      Int       @default(0)
  
  avgCostPrice    Float?
  totalValue      Float?
  location        String?
  
  isLowStock      Boolean   @default(false)
  isOverStock     Boolean   @default(false)
  hasExpiringSoon Boolean   @default(false)
  
  lastCountDate   DateTime?
  lastUpdated     DateTime  @updatedAt
  
  product         Product   @relation(fields: [productId], references: [id])
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id])
  
  @@unique([productId, warehouseId])
}

model InventoryTransaction {
  id              String    @id @default(uuid())
  type            String
  transactionNo   String    @unique
  
  productId       String
  batchNumber     String?
  expiryDate      DateTime?
  
  warehouseId     String
  fromWarehouseId String?
  toWarehouseId   String?
  
  quantity        Int
  orderedQty      Int?
  deliveredQty    Int?
  
  unitPrice       Float?
  discountedPrice Float?
  totalAmount     Float?
  
  reason          String?
  notes           String?
  
  orderId         String?
  supplierId      String?
  
  createdBy       String?
  approvedBy      String?
  approvedAt      DateTime?
  
  transactionDate DateTime  @default(now())
  createdAt       DateTime  @default(now())
  
  product         Product   @relation(fields: [productId], references: [id])
  warehouse       Warehouse @relation(fields: [warehouseId], references: [id])
  order           Order?    @relation(fields: [orderId], references: [id])

  @@index([warehouseId])
  @@index([productId])
  @@index([transactionDate])
  @@index([type])
}

// --- SALES & ORDERS ---

model Order {
  id          String   @id @default(uuid())
  orderNumber String   @unique
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  status      String   @default("PENDING") // PENDING, CONFIRMED, PROCESSING, SHIPPING, COMPLETED, CANCELLED
  totalAmount Float
  notes       String?
  
  items       OrderItem[]
  inventoryTransactions InventoryTransaction[]
  promotionApplications PromotionApplication[]
  
  discount    Float?   @default(0) // Chiết khấu tổng đơn
  
  deliveryDate DateTime?
  paymentStatus String @default("UNPAID")
  paymentMethod String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
  @@index([userId])
  @@index([pharmacyId])
  @@index([userId, createdAt])  // For user order history queries
  @@index([pharmacyId, createdAt])  // For pharmacy order queries
  @@index([status, createdAt])  // For status filtering with date
}

model OrderItem {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  
  quantity    Int
  price       Float
  subtotal    Float
  discount    Float    @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- VISIT & ROUTE MANAGEMENT ---

model Route {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  dayOfWeek   Int      // 1=Sun, 2=Mon, ...
  visitOrder  Int?
  isActive    Boolean  @default(true)
  frequency   String?  // F1, F2, F4, F8
  callObjective String? // e.g., "Introduce new product", "Collect payment", "Check inventory"
  notes       String?  // Pre-call notes or last visit summary
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, pharmacyId, dayOfWeek])
}

model VisitPlan {
  id          String   @id @default(uuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  territoryId String?
  territory   Territory? @relation(fields: [territoryId], references: [id])
  
  visitDate   DateTime
  visitTime   String?
  dayOfWeek   Int?
  frequency   String?
  
  status      String   @default("PLANNED") // PLANNED, IN_PROGRESS, COMPLETED, CANCELLED, MISSED
  purpose     String?
  notes       String?
  
  checkInTime  DateTime?
  checkOutTime DateTime?
  checkInLat   Float?
  checkInLng   Float?
  checkOutLat  Float?
  checkOutLng  Float?
  
  images      String[]
  completedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId, visitDate])  // For daily plan queries
  @@index([status])  // For status filtering
  @@index([visitDate])  // For date-based queries
  @@index([pharmacyId])  // For pharmacy visit history
}

// --- PROMOTIONS & LOYALTY ---

model Promotion {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  description String?
  type        String   // DISCOUNT, BUY_X_GET_Y, FREE_SHIPPING, GIFT
  
  discountType String? // PERCENTAGE, FIXED_AMOUNT
  discountValue Float?
  
  minOrderAmount Float?
  maxDiscountAmount Float?
  
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  
  applicableTo String  @default("ALL") // ALL, SEGMENT, TERRITORY, PHARMACY
  customerSegmentIds String[]
  territoryIds String[]
  
  items       PromotionItem[]
  applications PromotionApplication[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PromotionItem {
  id          String   @id @default(uuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  
  quantity    Int      // Quantity required or gifted
  discountValue Float? // Specific discount for this item
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PromotionApplication {
  id          String   @id @default(uuid())
  promotionId String
  promotion   Promotion @relation(fields: [promotionId], references: [id])
  
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id])
  
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  discountAmount Float
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model LoyaltyPoint {
  id          String   @id @default(uuid())
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  points      Int      @default(0)
  earnedPoints Int     @default(0)
  usedPoints   Int     @default(0)
  expiredPoints Int    @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([pharmacyId])
}

model LoyaltyTransaction {
  id          String   @id @default(uuid())
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  type        String   // EARN, REDEEM, EXPIRE, ADJUST
  points      Int
  referenceId String?  // Order ID or other ref
  description String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model LoyaltyReward {
  id             String   @id @default(uuid())
  name           String
  description    String?
  pointsRequired Int
  rewardType     String   // VOUCHER, PRODUCT, DISCOUNT
  rewardValue    String   // Voucher code, Product ID, or discount %
  stock          Int?
  isActive       Boolean  @default(true)
  
  redemptions    LoyaltyRedemption[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model LoyaltyRedemption {
  id          String   @id @default(uuid())
  pharmacyId  String
  pharmacy    Pharmacy @relation(fields: [pharmacyId], references: [id])
  
  rewardId    String
  reward      LoyaltyReward @relation(fields: [rewardId], references: [id])
  
  pointsUsed  Int
  status      String   @default("PENDING") // PENDING, COMPLETED, CANCELLED
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- KPI & PERFORMANCE ---

model KpiTarget {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  period      String   // YYYY-MM
  periodType  String   @default("MONTH") // MONTH, QUARTER, YEAR
  
  targetSales Float
  targetOrders Int
  targetVisits Int
  targetNewCustomers Int
  
  results     KpiResult[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, period])
}

model KpiResult {
  id          String   @id @default(uuid())
  targetId    String
  target      KpiTarget @relation(fields: [targetId], references: [id])
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  period      String
  
  actualSales Float    @default(0)
  actualOrders Int     @default(0)
  actualVisits Int     @default(0)
  actualNewCustomers Int @default(0)
  
  achievementRate Float @default(0)
  
  incentives  Incentive[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Incentive {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  period      String
  kpiResultId String?
  kpiResult   KpiResult? @relation(fields: [kpiResultId], references: [id])
  
  amount      Float
  type        String   // COMMISSION, BONUS, ALLOWANCE
  status      String   @default("PENDING") // PENDING, PAID
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- TRADE MARKETING & ACTIVITIES ---

model TradeActivity {
  id          String   @id @default(uuid())
  code        String   @unique
  name        String
  type        String   // EXHIBITION, SEMINAR, WORKSHOP, SPONSORSHIP
  description String?
  location    String?
  
  startDate   DateTime
  endDate     DateTime
  
  budget      Float?
  status      String   @default("PLANNED") // PLANNED, APPROVED, IN_PROGRESS, COMPLETED, CANCELLED
  
  organizerId String?
  organizer   User?    @relation(fields: [organizerId], references: [id])
  
  participants String[] // List of user IDs or Pharmacy IDs
  images      String[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}



// --- COMMUNICATION & APPROVALS ---

model Message {
  id          String   @id @default(uuid())
  senderId    String
  sender      User     @relation("SentMessages", fields: [senderId], references: [id])
  
  receiverId  String
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  
  subject     String?
  content     String
  isRead      Boolean  @default(false)
  type        String   @default("TEXT") // TEXT, NOTIFICATION, SYSTEM
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ApprovalRequest {
  id          String   @id @default(uuid())
  requesterId String
  requester   User     @relation("Requester", fields: [requesterId], references: [id])
  
  type        String   // LEAVE, EXPENSE, PROMOTION, ORDER
  referenceId String?
  details     String? // JSON string
  
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED
  currentApproverId String?
  
  actions     ApprovalAction[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ApprovalAction {
  id          String   @id @default(uuid())
  requestId   String
  request     ApprovalRequest @relation(fields: [requestId], references: [id])
  
  approverId  String
  approver    User     @relation(fields: [approverId], references: [id])
  
  action      String   // APPROVE, REJECT, COMMENT
  comment     String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- ANALYTICS & REPORTING ---

model RevenueStat {
  id          String   @id @default(uuid())
  period      String   // YYYY-MM-DD or YYYY-MM
  periodType  String   // DAY, MONTH, YEAR
  
  totalRevenue Float
  totalOrders  Int
  totalCustomers Int
  
  regionId    String?
  territoryId String?
  userId      String?
  productId   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Payment {
  id          String   @id @default(uuid())
  orderId     String
  amount      Float
  method      String   // CASH, BANK_TRANSFER, MOMO, ZALOPAY
  status      String   // PENDING, COMPLETED, FAILED
  transactionId String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SystemSetting {
  key         String   @id
  value       String
  description String?
  updatedAt   DateTime @updatedAt
}

model PermissionConfig {
  id          String   @id @default(uuid())
  role        String   @unique
  permissions Json     // Stores module-action mapping
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// =======================================
// ROUTE MANAGEMENT (SFA Standard)
// =======================================

// Template lộ trình mẫu
model RouteTemplate {
  id              String   @id @default(uuid())
  code            String   @unique        // RT-HCM-Q1-MON
  name            String                  // Lộ trình Q1 Thứ 2
  description     String?
  
  // Assignment
  territoryId     String?
  assignedRepId   String?                 // TDV mặc định
  dayOfWeek       String?                 // MONDAY, TUESDAY...
  
  // Route Details
  stops           RouteStop[]
  
  // Metrics
  estimatedDuration Int?                  // Phút
  estimatedDistance Float?                // Km
  estimatedCalls    Int?                  // Số khách
  
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  dailyRoutes     DailyRoute[]
}

// Điểm dừng trong lộ trình mẫu
model RouteStop {
  id              String   @id @default(uuid())
  routeTemplateId String
  routeTemplate   RouteTemplate @relation(fields: [routeTemplateId], references: [id], onDelete: Cascade)
  
  pharmacyId      String
  
  sequence        Int                    // Thứ tự ghé
  plannedArrival  String?                // "09:00"
  plannedDuration Int?                   // Phút tại điểm
  
  // Navigation
  distanceFromPrev Float?                // Km từ điểm trước
  durationFromPrev Int?                  // Phút di chuyển
  
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([routeTemplateId])
  @@index([pharmacyId])
}

// Lộ trình thực tế hàng ngày
model DailyRoute {
  id              String   @id @default(uuid())
  date            DateTime
  repId           String                 // TDV thực hiện
  
  templateId      String?
  template        RouteTemplate? @relation(fields: [templateId], references: [id])
  
  status          String   @default("PLANNED") // PLANNED, IN_PROGRESS, COMPLETED, CANCELLED
  startTime       DateTime?
  endTime         DateTime?
  
  // Actual performance
  plannedStops    Int?     @default(0)
  completedStops  Int?     @default(0)
  skippedStops    Int?     @default(0)
  
  // GPS Tracking
  startLat        Float?
  startLng        Float?
  endLat          Float?
  endLng          Float?
  totalDistance   Float?                 // Km thực tế
  
  notes           String?
  
  visits          Visit[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([date])
  @@index([repId])
  @@index([status])
}

// Chi tiết viếng thăm từng khách
model Visit {
  id              String   @id @default(uuid())
  dailyRouteId    String?
  dailyRoute      DailyRoute? @relation(fields: [dailyRouteId], references: [id])
  
  pharmacyId      String
  repId           String
  
  // Timing
  plannedArrival  DateTime?
  actualArrival   DateTime?
  departureTime   DateTime?
  duration        Int?                   // Phút thực tế
  
  // Location verification (Check-in)
  checkInLat      Float?
  checkInLng      Float?
  checkInPhoto    String?
  checkInDistance Float?                 // Khoảng cách từ vị trí KH (m)
  
  // Check-out
  checkOutLat     Float?
  checkOutLng     Float?
  checkOutPhoto   String?
  
  // Outcome
  status          String   @default("PLANNED") // PLANNED, CHECKED_IN, COMPLETED, SKIPPED, NO_ANSWER
  outcome         String?                // ORDER_PLACED, DISPLAY_UPDATED, INFO_COLLECTED, NO_ORDER
  
  // Results
  orderPlaced     Boolean  @default(false)
  orderId         String?
  orderAmount     Float?   @default(0)
  
  // Data collected
  notes           String?  @db.Text
  photos          String[]
  
  // Shelf/Display Check
  shelfPhotos     String[]
  displayScore    Int?                   // Điểm trưng bày 1-10
  stockStatus     String?                // IN_STOCK, LOW_STOCK, OUT_OF_STOCK
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([pharmacyId])
  @@index([repId])
  @@index([dailyRouteId])
  @@index([createdAt])
}

// =======================================
// REPORT TEMPLATES
// =======================================

model ReportTemplate {
  id          String   @id @default(uuid())
  code        String   @unique          // RPT_SALES_DAILY
  name        String                    // Báo cáo doanh số ngày
  category    String                    // SALES, VISIT, INVENTORY, CUSTOMER, PERFORMANCE
  description String?
  
  // Configuration
  columns     Json?                     // Column definitions
  filters     Json?                     // Available filters
  groupBy     String[]                  // Grouping options
  sortBy      String?                   // Default sort
  
  // Access
  allowedRoles String[]                 // Roles can access
  
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// =======================================
// EXCEL IMPORT/EXPORT TEMPLATES
// =======================================

model ExcelTemplate {
  id          String   @id @default(uuid())
  code        String   @unique          // TPL_CUSTOMER_IMPORT
  name        String                    // Template Import Khách hàng
  type        String                    // IMPORT, EXPORT
  entity      String                    // CUSTOMER, PRODUCT, ORDER, ROUTE
  
  // Template Structure
  columns     Json                      // Column definitions with mapping
  validations Json?                     // Validation rules
  sampleData  Json?                     // Sample row data
  
  // File
  fileUrl     String?                   // URL to download template
  fileName    String?
  
  description String?
  version     String   @default("1.0")
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// =======================================
// CHANNEL STRUCTURE (Cấu trúc Kênh)
// =======================================

// Master Channel definition
model Channel {
  id          String   @id @default(uuid())
  code        String   @unique          // GT, MT, CHAIN, HOSPITAL
  name        String                    // General Trade, Modern Trade, Chain, Hospital
  description String?
  
  // Parent-Child for hierarchy
  parentId    String?
  parent      Channel?  @relation("ChannelHierarchy", fields: [parentId], references: [id])
  children    Channel[] @relation("ChannelHierarchy")
  
  level       Int       @default(0)     // 0: Root, 1: Sub-channel
  
  // Metrics
  targetRevenue    Float?
  currentRevenue   Float?  @default(0)
  customerCount    Int?    @default(0)
  
  isActive    Boolean   @default(true)
  order       Int       @default(0)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  subChannels SubChannel[]
}

// Sub-channel for detailed classification
model SubChannel {
  id          String   @id @default(uuid())
  code        String   @unique          // GT_PHARMACY, GT_CLINIC, MT_SUPERMARKET
  name        String                    // Nhà thuốc GT, Phòng khám, Siêu thị
  
  channelId   String
  channel     Channel   @relation(fields: [channelId], references: [id])
  
  description String?
  isActive    Boolean   @default(true)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// =======================================
// GEOGRAPHIC HIERARCHY (Cấu trúc Địa lý)
// VN → Region → Area → Territory
// =======================================

model Country {
  id          String   @id @default(uuid())
  code        String   @unique          // VN
  name        String                    // Việt Nam
  
  regions     GeoRegion[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model GeoRegion {
  id          String   @id @default(uuid())
  code        String   @unique          // NORTH, CENTRAL, SOUTH
  name        String                    // Miền Bắc, Miền Trung, Miền Nam
  
  countryId   String
  country     Country   @relation(fields: [countryId], references: [id])
  
  // Management
  rsmId       String?                   // Regional Sales Manager ID
  rsmName     String?
  
  // Metrics
  targetRevenue    Float?
  currentRevenue   Float?  @default(0)
  
  areas       Area[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Area {
  id          String   @id @default(uuid())
  code        String   @unique          // AREA_HCM, AREA_HN
  name        String                    // Khu vực HCM, Khu vực Hà Nội
  
  geoRegionId String
  geoRegion   GeoRegion @relation(fields: [geoRegionId], references: [id])
  
  // Management
  asmId       String?                   // Area Sales Manager ID
  asmName     String?
  
  // Metrics
  targetRevenue    Float?
  currentRevenue   Float?  @default(0)
  territoryCount   Int?    @default(0)
  
  geoTerritories GeoTerritory[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model GeoTerritory {
  id          String   @id @default(uuid())
  code        String   @unique          // TER_Q1, TER_Q7
  name        String                    // Quận 1, Quận 7
  
  areaId      String
  area        Area      @relation(fields: [areaId], references: [id])
  
  // Management
  tsmId       String?                   // Territory Sales Manager / Supervisor
  tsmName     String?
  
  // Geography
  districts   String[]
  wards       String[]
  
  // Metrics
  targetRevenue    Float?
  currentRevenue   Float?  @default(0)
  customerCount    Int?    @default(0)
  activeCustomers  Int?    @default(0)
  coverageRate     Float?  @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// =======================================
// ORGANIZATION HIERARCHY (Cấu trúc Quản lý)
// BU Head → RSM → ASM → TSM → TDV
// =======================================

model OrgPosition {
  id          String   @id @default(uuid())
  code        String   @unique          // BU_HEAD, RSM, ASM, TSM, TDV
  name        String                    // BU Head, Regional Sales Manager, Area Sales Manager, Territory Sales Manager, Sales Rep
  nameVi      String?                   // Trưởng đơn vị KD, Quản lý vùng, Quản lý khu vực, Giám sát, TDV
  
  level       Int       @default(0)     // 0: Top, 1, 2, 3, 4: Bottom
  
  // Parent position for reporting line
  reportsToId String?
  reportsTo   OrgPosition?  @relation("PositionHierarchy", fields: [reportsToId], references: [id])
  subordinates OrgPosition[] @relation("PositionHierarchy")
  
  // Permissions & Scope
  canApproveOrder   Boolean  @default(false)
  canApproveCustomer Boolean @default(false)
  maxApprovalAmount Float?
  
  description String?
  isActive    Boolean   @default(true)
  
  employees   Employee[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Employee {
  id          String   @id @default(uuid())
  employeeCode String  @unique          // EMP001
  name        String
  email       String?
  phone       String?
  
  // Position & Role
  positionId  String
  position    OrgPosition @relation(fields: [positionId], references: [id])
  
  // Direct Manager
  managerId   String?
  manager     Employee?  @relation("ManagerHierarchy", fields: [managerId], references: [id])
  subordinates Employee[] @relation("ManagerHierarchy")
  
  // Geographic Assignment
  geoRegionId    String?              // RSM: quản lý Region
  areaId         String?              // ASM: quản lý Area
  geoTerritoryId String?              // TSM: quản lý Territory
  
  // Channel Assignment
  channelId      String?              // Assigned to specific channel
  
  // Linked User Account
  userId         String?  @unique
  
  // Status
  status      String    @default("ACTIVE") // ACTIVE, INACTIVE, ON_LEAVE
  joinDate    DateTime?
  
  // Targets
  monthlyTarget   Float?
  quarterlyTarget Float?
  yearlyTarget    Float?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([positionId])
  @@index([managerId])
}

// =======================================
// ORGANIZATION CHART CONFIG
// =======================================

model OrgChartConfig {
  id          String   @id @default(uuid())
  
  // Company Info
  companyName String   @default("An Minh Pharmaceutical")
  companyCode String   @default("AMPH")
  
  // Structure Settings
  geoLevels   Json?    // ["Country", "Region", "Area", "Territory"]
  channelTypes Json?   // ["GT", "MT", "Chain", "Hospital"]
  positionLevels Json? // ["BU_HEAD", "RSM", "ASM", "TSM", "TDV"]
  
  // Display Settings
  showMetrics   Boolean @default(true)
  showTargets   Boolean @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// =======================================
// ROLE HIERARCHY (Salesforce-style)
// Controls data access and record visibility
// =======================================

model Role {
  id          String   @id @default(uuid())
  code        String   @unique           // CEO, BU_HEAD, RSM, ASM, TSM, TDV
  name        String                     // Chief Executive Officer, Business Unit Head...
  nameVi      String?                    // Vietnamese name
  
  // Hierarchy
  parentId    String?
  parent      Role?    @relation("RoleHierarchy", fields: [parentId], references: [id])
  children    Role[]   @relation("RoleHierarchy")
  
  level       Int      @default(0)       // 0: Top, 1, 2, 3... descending
  
  // Access Control (Salesforce-style)
  accessLevel String   @default("PRIVATE") // ALL, PRIVATE, READ_ONLY, READ_WRITE
  
  // Can view records of subordinate roles
  canViewSubordinates Boolean @default(true)
  canEditSubordinates Boolean @default(false)
  canDeleteSubordinates Boolean @default(false)
  
  // Data Scope
  dataScope   String   @default("OWN")   // ALL, REGION, AREA, TERRITORY, OWN
  
  description String?
  isActive    Boolean  @default(true)
  
  // Relations
  users       RoleUser[]
  permissions RolePermission[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([level])
  @@index([parentId])
}

// User-Role Assignment
model RoleUser {
  id        String   @id @default(uuid())
  userId    String
  roleId    String
  role      Role     @relation(fields: [roleId], references: [id])
  
  isPrimary Boolean  @default(true)      // Primary role
  
  assignedAt DateTime @default(now())
  assignedBy String?
  
  createdAt DateTime @default(now())
  
  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
}

// Role Permissions
model RolePermission {
  id          String   @id @default(uuid())
  roleId      String
  role        Role     @relation(fields: [roleId], references: [id])
  
  objectType  String                     // Customer, Order, Product, Report, User...
  canRead     Boolean  @default(true)
  canCreate   Boolean  @default(false)
  canEdit     Boolean  @default(false)
  canDelete   Boolean  @default(false)
  canExport   Boolean  @default(false)
  
  // Field-level security
  restrictedFields String[]              // Fields that are hidden/masked
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([roleId, objectType])
  @@index([roleId])
}

// =======================================
// TERRITORY MANAGEMENT WITH KPIs
// =======================================

model TerritoryKPI {
  id              String   @id @default(uuid())
  
  // Territory assignment
  territoryId     String?                // Link to GeoTerritory
  areaId          String?                // Link to Area
  regionId        String?                // Link to GeoRegion
  
  // Period
  year            Int
  month           Int?                   // Null = yearly, else monthly
  quarter         Int?                   // 1, 2, 3, 4
  
  // Sales Targets
  salesTarget     Float    @default(0)
  salesActual     Float    @default(0)
  salesAchievement Float?               // Calculated: actual/target * 100
  
  // Visit Targets
  visitTarget     Int      @default(0)
  visitActual     Int      @default(0)
  visitAchievement Float?
  
  // Customer Targets
  newCustomerTarget   Int   @default(0)
  newCustomerActual   Int   @default(0)
  activeCustomerTarget Int  @default(0)
  activeCustomerActual Int  @default(0)
  
  // Coverage
  coverageTarget  Float    @default(0)   // % outlets visited
  coverageActual  Float    @default(0)
  
  // Strike Rate
  strikeRateTarget Float   @default(0)   // % visits with order
  strikeRateActual Float   @default(0)
  
  // SKU Distribution
  skuTarget       Float    @default(0)   // Avg SKUs per outlet
  skuActual       Float    @default(0)
  
  // Drop Size
  dropSizeTarget  Float    @default(0)   // Avg order value
  dropSizeActual  Float    @default(0)
  
  // Notes
  notes           String?
  
  // Status
  status          String   @default("ACTIVE") // ACTIVE, CLOSED, REVISED
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([territoryId, year, month])
  @@index([year])
  @@index([territoryId])
  @@index([areaId])
  @@index([regionId])
}

// =======================================
// ASSIGNMENT RULES ENGINE
// Automatic territory/customer assignment
// =======================================

model AssignmentRule {
  id          String   @id @default(uuid())
  name        String
  description String?
  
  // Rule Type
  ruleType    String                     // CUSTOMER, TERRITORY, LEAD, ORDER
  
  // Priority (lower = higher priority)
  priority    Int      @default(100)
  
  // Conditions (JSON Array)
  // e.g., [{"field": "district", "operator": "equals", "value": "District 1"}]
  conditions  Json
  
  // Action
  actionType  String                     // ASSIGN_TO_USER, ASSIGN_TO_TERRITORY, ASSIGN_TO_QUEUE
  assignToUserId      String?
  assignToTerritoryId String?
  assignToRoleId      String?
  
  // Notification
  sendNotification Boolean @default(true)
  notificationTemplate String?
  
  // Status
  isActive    Boolean  @default(true)
  
  // Execution Count
  executionCount Int   @default(0)
  lastExecutedAt DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([ruleType])
  @@index([priority])
}

// Assignment History
model AssignmentHistory {
  id              String   @id @default(uuid())
  
  // What was assigned
  objectType      String                 // Customer, Lead, Order
  objectId        String
  
  // Assignment details
  fromUserId      String?
  toUserId        String?
  fromTerritoryId String?
  toTerritoryId   String?
  
  // How was it assigned
  assignmentMethod String               // MANUAL, AUTO_RULE, ROUND_ROBIN, LOAD_BALANCE
  ruleId          String?               // If assigned by rule
  
  // Who made the change
  assignedBy      String?
  
  // Reason
  reason          String?
  
  createdAt       DateTime @default(now())
  
  @@index([objectType, objectId])
  @@index([toUserId])
  @@index([toTerritoryId])
}

// =======================================
// REPORTING LINE VALIDATION
// =======================================

model ReportingLineConfig {
  id              String   @id @default(uuid())
  
  // Which position reports to which
  positionId      String   @unique
  reportsToPositionId String?           // Null = top of hierarchy
  
  // Validation Rules
  maxSubordinates Int?                   // Max direct reports
  requiresApproval Boolean @default(false) // Changes need approval
  
  // Skip levels allowed
  allowSkipLevel  Boolean  @default(false)
  
  // Cross-functional reporting
  allowCrossFunction Boolean @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Reporting Change Requests
model ReportingChangeRequest {
  id              String   @id @default(uuid())
  
  // Employee being changed
  employeeId      String
  
  // Current and proposed manager
  currentManagerId String?
  proposedManagerId String?
  
  // Reason for change
  reason          String
  effectiveDate   DateTime
  
  // Approval workflow
  status          String   @default("PENDING") // PENDING, APPROVED, REJECTED, CANCELLED
  requestedBy     String
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([employeeId])
  @@index([status])
}



